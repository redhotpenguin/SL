[% PROCESS header.tmpl title="Silver Lining Dashboard:  Create or edit router"  selected="network" %]

<div class="grid_16">
	<div id="breadcrumb">
		<div id="breadcrumb_inner">
			<ul>
				[% PROCESS router/nav.tmpl %] 

				<li><strong>[% UNLESS router.router_id  %]New router[% ELSE %]Edit router '[% router.name %]'[% END %]</strong></li>
			</ul>
		</div>
	</div>
</div>
<div class="clear"></div>


<div id="main_content" class="grid_9 suffix_2">

[% IF !router && (reg.account_id.account_id !=2 ) %]
	<!-- IF TRYING TO ADD A NEW ROUTER -->
	<h3>Existing Customers</h3>
	<p>Learn about our brand new Silver Lining Repeaters. Our <a href="http://www.silverliningnetworks.com/store/">new repeaters are plug and play</a> and work out of the box!</p>
	<p>If you are already using one or more WRT54GL device, rest assured you are a highly valued customer and we will continue to support you and your WRT54GL for the life of your account.</p>
	 
	<h3>Open-Mesh.com Users</h3>
	<p>If you have an existing Open-Mesh.com account, <a href="[% base_uri %]/app/router/omsync">click here</a> to sync Silver Lining with your Open-Mesh.com network and update your list of devices.</p>
	<p><a href="http://silverlining.zendesk.com/forums/26828/entries/37866">Click here</a> to learn more about integrating Open-Mesh.com with Silver Lining.</p>


[% ELSE %]
	<!-- IF TRYING TO EDIT AN EXISTING ROUTER -->
	<h2>[% IF router.name %][% router.name %][% ELSE %]Add New Router[% END %]</h2>



	<form class="row" method="post" action="[% base_uri %]/app/router/edit">
		[% IF errors.missing %]<p class="error">Please complete the missing fields</p>[% END %]
		[% IF errors.invalid %]<p class="error">Some fields were invalid, please correct them</p>[% END %]




		<input type="hidden" name="router_id" value="[% router.router_id %]"/>
		<ul>
			<li>
				<div class="grid_8 alpha omega suffix_2 form_row">
					<!-- device -->
					<label for="device" class="label [% IF errors.missing.device %]error[% END %]">Device Type</label>
					<select name="device" id="device">
						<option value="" [% IF ! router.device and req.param('device') == '' %][% END %]>Select a device type</option>
						<option value="mr3201a" [% IF req.param('device') == 'mr3201a' or router.device == 'mr3201a' %]SELECTED[% END %]>Open-Mesh.com 32MB (MR3201A, OM1P, PicoStation)</option>
						[% IF router || reg.account_id.account_id == 2 %]<option value="wrt54gl" [% IF req.param('device') == 'wrt54gl' or router.device == 'wrt54gl' %]SELECTED[% END %]>Linksys WRT54GL</option>[% END %]

					</select>

						<!-- value="linuxbox" [% IF req.param('device') == 'linuxbox' or router.device =='linuxbox' %]SELECTED[% END %]>Centos 5.2 Linux Server</option>-->
					<div class="clear"></div>
					<label for="device" class="tip">Silver Lining currently works with only the devices in the list above.</label>
					<div class="clear"></div>
					<label for="device" class="tip">Greyed out items are controlled from your <a href="http://www.open-mesh.com/dashboard.php">Open-Mesh.com dashboard</a></label>
				</div>
				<div class="clear"></div>
			</li>	
		</ul>		
		
		
		<ul class="form"> 

			<li>
				<div class="grid_6 alpha omega suffix_4">
					<!-- macaddr -->
					<label for="macaddr" class="[% IF errors.missing.macaddr or errors.invalid.macaddr %]error[% END %]">Mac address</label>
					<input type="text" name="macaddr" id="macaddr" size="17" maxlength="17" value='[% req.param('macaddr') or router.displaymac %]'/>
					<div class="clear"></div>
					<label for="macaddr" class="tip">Example:  00:12:cf:43:38:bd</label>
				</div>
				<div class="clear"></div>
			</li>	

			<li>
				<div class="grid_6 alpha omega suffix_4">
					<!-- name -->
					<label for="name" class="[% IF errors.missing.name %]error[% END %]">Name</label>
					<input type="text" id="name" name="name" size="40" maxlength="50" value="[% req.param('name') or router.name %]"/>
					<div class="clear"></div>
					<label for="name" class="tip">50 character limit</label>
				</div>
				<div class="clear"></div>
			</li>	

			<li id="wrt54gl">
				<div class="grid_8 alpha omega suffix_2">
					<!-- notes -->
					<label for="notes">Notes</label>
					<textarea id="notes" name="notes" rows="2" cols="50">[% req.param('notes') or router.notes %]</textarea>
					<div class="clear"></div>
					<label for="notes" class="tip">100 character limit</label>
				</div>
				<div class="clear"></div>				
			
				<div class="grid_6 alpha omega suffix_4 form_row">
					<div id="ssid">
						<!-- SSID -->
						<label for="ssid" class="[% IF errors.missing.ssid %]error[% END %]">Allow up to five minutes to take effect</label>
						<input type="text" id="ssid" name="ssid" size="25" maxlength="25" value='[% req.param('ssid') or router.ssid %]'/>
						<div class="clear"></div>
						<label for="ssid" class="tip">Allow up to five minutes to take effect</label>
					</div>

							
					<div id="serial">
						<!-- serial number -->
						<label for="serial_number" class="[% IF errors.missing.serial_number or errors.invalid.serial_number %]error[% END %]">Serial number or service tag</label>
						<input type="text" id="serial_number" name="serial_number" size="25" maxlength="25" value='[% req.param('serial_number') or router.serial_number %]'/>
						<label for="serial_number" class="tip">Optional, to determine router model compatibility, example CL7A0F318014</label>
					</div>
				</div>
				<div class="clear"></div>

				<div class="grid_6 alpha omega suffix_4 form_row">
					<!-- splash page -->
					<label for="splash_href" class="[% IF errors.missing.splash_href or errors.invalid.splash_href %]error[% END %]">Splash page url</label>
					<input type="text" id="splash_href" name="splash_href" size="45" maxlength="255" value='[% req.param('splash_href') or router.splash_href %]'/>
					<div class="clear"></div>
					<label for="splash_href" class="tip">Example:  http://silverliningworks.typepad.com/network/</label>
					<div class="clear"></div>
					<label for="splash_href" class="tip">Available on Linksys WRT54GL and Linux server only</label>
				</div>
				<div class="clear"></div>
	
				<div class="grid_6 alpha omega suffix_4 form_row">
					<!-- splash page timeout -->
					<label for="splash_timeout" class="[% IF errors.missing.splash_timeout or errors.invalid.splash_timeout %]error[% END %]">Splash page timeout</label>
					<input type="text" id="splash_timeout" name="splash_timeout" size="3" maxlength="3" value='[% req.param('splash_timeout') or router.splash_timeout or '20' %]'/>
					<div class="clear"></div>
					<label for="splash_timeout" class="tip">Number of inactive minutes before splash page is shown</label>
				</div>
				<div class="clear"></div>
			</li>	


			<li>
				<div class="grid_10 alpha omega">
					<!-- ad zones -->
					<label for="zone_type">Select one of the following three options for display on this router</label>
					[% IF msg_zone %]
						<input id="text" type="radio" name="zone_type" value="msg" [% IF msg_zone.selected %]checked="1"[% END %]/>
						<label for="msg" class="check_label">1 - Text Message Bar</label>
					[% ELSE %]
						<input id="text" type="radio" name="zone_type" value="msg" disabled="1" />
						<label for="msg" class="check_label">1 - Configure your <a href="[% base_uri %]/app/ad/msg/index">Text Message Bar</a> to enable a Text Message in your message bar.</label>
					[% END %]
					
					
					<!-- twitter -->
					[% IF twit_zone %]
						<input id="twitter" type="radio" name="zone_type" value="twitter" [% IF twit_zone.selected %]checked="1"[% END %] />
						<label for="twitter" class="check_label">2 - Twitter Feed</label>
					[% ELSE %]
						<input id="twitter" type="radio" name="zone_type" value="twitter" disabled="1" />
						<label for="twitter" class="check_label">2 - Configure your <a href="[% base_uri %]/app/ad/twitter/index">Twitter Feed</a> to enable Twitter in your message bar.</label>
					[% END %]
			
			
					<input id="iab" type="radio" name="zone_type" value="iab" [% IF !twit_zone.selected and !msg_zone.selected %]checked="1"[% END %]/>
					<label for="iab" class="check_label">3 - Ad Server Ad Zones</label>
			
					<table style="margin-left:30px;">
						[% IF ad_zones %]
						[% FOREACH ad_zone = ad_zones %]
						[% IF loop.index % 2 == 0 %] <tr>[% END %]
						    <td>
						    	<input id="adzone" type="checkbox" name="ad_zone" value="[% ad_zone.ad_zone_id %]"[% IF ad_zone.selected or (req.param('ad_zone_id') == ad_zone.ad_zone_id) %]CHECKED[% END %]><label class="check_label">[% ad_zone.name %]</label>
						    </td>
						[% IF loop.index % 2 != 0 %] </tr>[% END %]
						[% END %]
					</table>
					
					<label class="check_label" for="ad_zone">Click checkbox to add the ad zone to the router (random rotation)</label>
					[% ELSE %]
						<p class="error">You have not created any ad zones, please <a href="/app/ad/groups/list">create a few</a> to serve ads on this router</p>
					[% END %]
					</div>
				<div class="clear"></div>			
			</li>
			
			<li>
				<div class="grid_6 alpha omega suffix_4">
		<!-- adbar -->
					<label for="adserving">Ad Bar</label>
					<div class="clear"></div>
					<label for="adserving" class="tip">Turn the ad and messaging bar On or Off.  Takes 5-15 minutes to take effect.</label>
					<input type="radio" name="adserving" value="t" [% IF router.adserving == 1 %]checked[% END %]/><label for="adserving" class="check_label">On</label>
					<input type="radio" name="adserving" value="f" [% IF ad_zone.adserving == 0 %] checked [% END %]/><label for="adserving" class="check_label">Off</label>
					<div class="clear"></div>
				</div>
				<div class="clear"></div>
			</li>	
			
			<li>
				<div class="grid_6 alpha omega suffix_4">
					<!-- active -->
					<label for="active">Active</label>
					<div class="clear"></div>
					<label class="tip" for="active">Is this router active? (To ensure consistency in reporting, routers cannot be deleted, just hidden)</label>
					<input type="radio" name="active" value="t" [% IF router.active ==1 %]checked[% END %]><label class="check_label">Yes</label>
					<input type="radio" name="active" value="f" [% IF ad_zone.active == 0 %] checked [% END %]><label class="check_label">No</label>
					<div class="clear"></div>
				</div>
				<div class="clear"></div>
			</li>	
			
			<li>
				<input id="submit" type="Submit" value="Save router settings" size="50"/>
			</li>
		</ul>		
	</form>

[% END %]

</div>


<div id="secondary_content" class="grid_5">
	<div id="sc_top">
		<div id="sc_bottom">
			[% IF locations != '' %]
			
			<p>This device has been registered at the following locations and times:</p>
			
			[% FOREACH location = locations %]
			<ul class="bullet_list">
			      <li>[% IF location.name %][% location.name %] - [% ELSE %][% END %]
			          [% location.ip %] - [% location.mts %]</li>
			</ul>
			[% END %]
			
			[% END %]
	
		</div>
	</div>
</div>


[% PROCESS footer.tmpl %]
