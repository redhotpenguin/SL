#!/usr/bin/env perl

use strict;
use warnings;

use SL::Client::Maintd;

our $MAILER = (-d '/var/qmail') ? 'qmail' : 'sendmail';
my $hostname = 'herbert';
my $admin = 'fred@redhotpenguin.com';
my $maintd = SL::Client::Maintd->new;
my %report;

foreach my $status qw( uptime ip dns ping tunnel ) {
    $report{$status} = $maintd->$status;
}

use Mail::Mailer;
use Data::Dumper;

my $mailer = Mail::Mailer->new($MAILER);

$mailer->open({
    From    => "$hostname\@redhotpenguin.com",
    To      => $admin,
    Subject => uc($hostname) . " Status Report"
    }
);

my $body = "Maintd report ran at " . time() . "\n\n" . 
    Data::Dumper::Dumper(\%report);
print $mailer $body;
$mailer->close;
